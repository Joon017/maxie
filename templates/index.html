<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Clean Calendar</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="{{ url_for('static', filename='css/calendar.css') }}" rel="stylesheet">
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-light">
        <div class="container">
            <a class="navbar-brand" href="#">
                <i class="fas fa-calendar-alt me-2"></i>Clean Calendar
            </a>
        </div>
    </nav>

    <div class="app-container d-flex">
  <!-- Calendar area -->
  <div class="calendar-section flex-grow-1">
        <div class="container mt-4">
        <div class="row">
            <!-- Layer Controls Sidebar -->
            <div class="col-md-3">
                <div class="layer-controls">
                    <div class="d-flex justify-content-between align-items-center">
                        <h6><i class="fas fa-layer-group me-2"></i>Calendar Layers</h6>
                        <div>
                            <button class="layer-add-btn" data-bs-toggle="modal" data-bs-target="#layerModal" title="Add Layer">
                                <i class="fas fa-plus"></i>
                            </button>
                            <button class="layer-controls-toggle" id="showAllLayers" title="Show All">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button class="layer-controls-toggle" id="hideAllLayers" title="Hide All">
                                <i class="fas fa-eye-slash"></i>
                            </button>
                        </div>
                    </div>
                    <div id="layersList">
                        <!-- Layers will be populated here -->
                    </div>
                </div>
            </div>

            <!-- Calendar Area -->
            <div class="col-md-9">
                <div class="calendar-header">
                    <div class="calendar-nav">
                        <div>
                            <button class="btn btn-nav" id="prevMonth">
                                <i class="fas fa-chevron-left"></i>
                            </button>
                            <button class="btn btn-nav" id="nextMonth">
                                <i class="fas fa-chevron-right"></i>
                            </button>
                            <button class="btn btn-nav ms-2" id="todayBtn">Today</button>
                        </div>
                        
                        <h2 id="currentMonth">January 2024</h2>
                        
                        <div>
                            <div class="view-buttons">
                                <button class="btn btn-nav active" id="monthView">Month</button>
                                <button class="btn btn-nav" id="weekView">Week</button>
                                <button class="btn btn-nav" id="dayView">Day</button>
                                <button class="btn btn-nav" id="recurringView">Recurring</button>
                            </div>
                            <button class="btn btn-primary ms-3" data-bs-toggle="modal" data-bs-target="#eventModal">
                                <i class="fas fa-plus me-1"></i>New Event
                            </button>
                        </div>
                    </div>
                </div>

                <div id="calendarView">
                    <!-- Calendar will be rendered here -->
                </div>
            </div>
        </div>
    </div>
  </div>

  <!-- Chat area -->
    <!-- Chat -->
    <div class="chat-section">
      <div class="chat-header">Assistant</div>
      <div class="chat-messages" id="chatMessages"></div>
      <div class="chat-input">
        <input type="text" id="chatInput" placeholder="Type a message..." />
        <button id="sendBtn" class="btn btn-primary btn-sm">Send</button>
      </div>
    </div>
  </div>
</div>




    <!-- Event Modal -->
    <div class="modal fade" id="eventModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="eventModalTitle">New Event</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>

                
                <div class="modal-body">
                    <form id="eventForm">
                        <input type="hidden" id="eventId">
                        
                        <div class="mb-3">
                            <label for="eventTitle" class="form-label">Title *</label>
                            <input type="text" class="form-control" id="eventTitle" required>
                        </div>
                        
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label for="eventStart" class="form-label">Start Date & Time *</label>
                                <input type="datetime-local" class="form-control" id="eventStart" required>
                            </div>
                            <div class="col-md-6">
                                <label for="eventEnd" class="form-label">End Date & Time *</label>
                                <input type="datetime-local" class="form-control" id="eventEnd" required>
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="allDay">
                                <label class="form-check-label" for="allDay">
                                    All Day Event
                                </label>
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <label for="eventLayer" class="form-label">Calendar Layer *</label>
                            <select class="form-control" id="eventLayer" required>
                                <!-- Options will be populated dynamically -->
                            </select>
                        </div>
                        
                        <div class="mb-3">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="isRecurring">
                                <label class="form-check-label" for="isRecurring">
                                    <i class="fas fa-redo me-1"></i>Recurring Event
                                </label>
                            </div>
                        </div>

                        <div id="recurringOptions" style="display: none;">
                            <div class="row mb-3">
                                <div class="col-md-6">
                                    <label for="recurrenceType" class="form-label">Repeats</label>
                                    <select class="form-control" id="recurrenceType">
                                        <option value="daily">Daily</option>
                                        <option value="weekly" selected>Weekly</option>
                                        <option value="monthly">Monthly</option>
                                    </select>
                                </div>
                                <div class="col-md-6">
                                    <label for="recurrenceInterval" class="form-label">Every</label>
                                    <div class="input-group">
                                        <input type="number" class="form-control" id="recurrenceInterval" value="1" min="1" max="12">
                                        <span class="input-group-text" id="intervalUnit">week(s)</span>
                                    </div>
                                </div>
                            </div>

                            <div class="mb-3">
                                <label class="form-label">Ends</label>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="recurrenceEnd" id="endNever" value="never" checked>
                                    <label class="form-check-label" for="endNever">Never</label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="recurrenceEnd" id="endAfter" value="count">
                                    <label class="form-check-label" for="endAfter">After</label>
                                    <input type="number" class="form-control d-inline-block ms-2" id="endAfterCount" value="10" min="1" max="100" style="width: 70px;">
                                    <span class="ms-1">occurrences</span>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="recurrenceEnd" id="endOn" value="date">
                                    <label class="form-check-label" for="endOn">On</label>
                                    <input type="date" class="form-control d-inline-block ms-2" id="endOnDate" style="width: 150px;">
                                </div>
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <label for="eventLocation" class="form-label">Location</label>
                            <input type="text" class="form-control" id="eventLocation" placeholder="Add location">
                        </div>
                        
                        <div class="mb-3">
                            <label for="eventDescription" class="form-label">Description</label>
                            <textarea class="form-control" id="eventDescription" rows="3" placeholder="Add description"></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-outline-danger" id="deleteEvent" style="display: none;">
                        <i class="fas fa-trash me-1"></i>Delete
                    </button>
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="saveEvent">
                        <i class="fas fa-save me-1"></i>Save
                    </button>
                </div>
            </div>
        </div>
    </div>

<div class="modal fade" id="editRecurringModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Edit Recurring Event</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <p>This is a recurring event. How would you like to edit it?</p>
                <div class="d-grid gap-2">
                    <button class="btn btn-outline-primary" id="editSingleInstance">
                        <i class="fas fa-edit me-2"></i>Edit only this occurrence
                    </button>
                    <button class="btn btn-primary" id="editEntireSeries">
                        <i class="fas fa-redo me-2"></i>Edit entire series
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>


<!-- Kanban Modal (sibling to dayModal) -->
<div class="modal fade" id="kanbanModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-xl modal-dialog-scrollable">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="kanbanTitle">Tasks Board</h5>

        <div class="ms-3 btn-group btn-group-sm" role="group" aria-label="Zoom">
          <button type="button" class="btn btn-outline-secondary" id="kanbanZoomOut">–</button>
          <button type="button" class="btn btn-outline-secondary disabled" id="kanbanZoomLabel">100%</button>
          <button type="button" class="btn btn-outline-secondary" id="kanbanZoomIn">+</button>
        </div>

        <button type="button" class="btn btn-primary btn-sm ms-2" id="kbNewTaskBtn">
          <i class="fas fa-plus me-1"></i> New Task
        </button>

        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>

      <div class="modal-body">
        <!-- Board -->
        <div id="kanbanBoard" class="kb-board">
          <div class="kb-col" data-status="planned">
            <div class="kb-col-head">Planned <span class="kb-badge" id="kbCntPlanned">0</span></div>
            <div class="kb-col-body" id="kbPlanned"></div>
          </div>

          <div class="kb-col" data-status="started">
            <div class="kb-col-head">Started <span class="kb-badge" id="kbCntStarted">0</span></div>
            <div class="kb-col-body" id="kbStarted"></div>
          </div>

          <div class="kb-col" data-status="in_progress">
            <div class="kb-col-head">In progress <span class="kb-badge" id="kbCntProgress">0</span></div>
            <div class="kb-col-body" id="kbProgress"></div>
          </div>

          <div class="kb-col" data-status="completed">
            <div class="kb-col-head">Completed <span class="kb-badge" id="kbCntDone">0</span></div>
            <div class="kb-col-body" id="kbDone"></div>
          </div>
        </div>
      </div>

      <div class="modal-footer">
        <button class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>

<!-- Task Editor Modal -->
<!-- Task Editor Modal -->
<div class="modal fade" id="taskEditModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <form id="taskEditForm" autocomplete="off">
        <div class="modal-header">
          <h5 class="modal-title" id="taskEditTitle">New Task</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>

        <div class="modal-body">
          <input type="hidden" id="taskId">

          <div class="mb-3">
            <label for="taskName" class="form-label">Task name *</label>
            <input id="taskName" class="form-control" required>
          </div>

          <div class="row g-3">
            <div class="col-sm-6">
              <label for="taskDueAt" class="form-label">Due (optional)</label>
              <input id="taskDueAt" class="form-control" placeholder="YYYY-MM-DDTHH:MM">
              <div class="form-text">Use local time; leave blank if none.</div>
            </div>
            <div class="col-sm-6">
              <label for="taskStatus" class="form-label">Status</label>
              <select id="taskStatus" class="form-select">
                <option value="planned">Planned</option>
                <option value="started">Started</option>
                <option value="in_progress">In progress</option>
                <option value="completed">Completed</option>
              </select>
            </div>
          </div>

          <div class="mt-3">
            <label for="taskDetails" class="form-label">Details</label>
            <textarea id="taskDetails" class="form-control" rows="5" placeholder="Notes, checklist, links…"></textarea>
          </div>

          <div class="mt-3">
            <label class="form-label">Committed at</label>
            <input id="taskCommittedAt" class="form-control" disabled>
            <div class="form-text">Auto-filled when the task is created.</div>
          </div>
        </div>

        <div class="modal-footer">
          <button type="button" class="btn btn-outline-danger me-auto d-none" id="taskDeleteBtn">Delete</button>
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
          <button type="submit" class="btn btn-primary" id="taskSaveBtn">Save Task</button>
        </div>
      </form>
    </div>
  </div>
</div>


<!-- Day View Modal -->
<!-- Day View Modal -->
<div class="modal fade" id="dayModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-xl modal-dialog-scrollable">
    <div class="modal-content">
      <div class="modal-header">
        <div class="d-flex align-items-center gap-2">
          <button type="button" class="btn btn-sm btn-outline-secondary" id="dayModalPrev">
            <i class="fas fa-chevron-left"></i>
          </button>
          <h5 class="modal-title day-modal-title" id="dayModalTitle">Day</h5>
          <button type="button" class="btn btn-sm btn-outline-secondary" id="dayModalNext">
            <i class="fas fa-chevron-right"></i>
          </button>
           <!-- Zoom controls -->
  <div class="btn-group btn-group-sm ms-3">
    <button id="dayZoomOut" class="btn btn-outline-secondary" title="Zoom out">−</button>
    <button id="dayZoomIn" class="btn btn-outline-secondary" title="Zoom in">+</button>
  </div>
        </div>
        
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>

<div class="modal-body p-0 day-modal-body">
  <div class="day-modal-content d-flex">
    <!-- LEFT: calendar timeline -->
    <div class="day-left border-end">
      <div class="day-calendar-scroll">
        <div class="d-flex">
          <!-- hour ruler (JS writes into this) -->
          <div class="day-modal-ruler"></div>
          <!-- absolute-positioned grid for events (JS positions items here) -->
          <div class="flex-grow-1 position-relative day-modal-grid" id="dayModalGrid"></div>
        </div>
      </div>
    </div>

    <!-- RIGHT: sidebar -->
    <aside class="day-right d-flex flex-column">
      <!-- Tasks -->
      <div class="card mb-3 flex-fill">
  <div class="card-header d-flex justify-content-between align-items-center">
    <strong>Tasks</strong>
    <div class="d-flex align-items-center gap-2">
      <small id="tasksDateLabel" class="text-muted"></small>
      <button id="openKanbanBtn" class="btn btn-sm btn-outline-secondary">Board</button>
    </div>
  </div>
  <div class="card-body p-2 day-sidebar-scroll">
    <div class="input-group input-group-sm mb-2">
      <input id="addTaskInput" class="form-control" placeholder="Quick add…">
      <button id="addTaskBtn" class="btn btn-outline-primary">Add</button>
    </div>
    <ul id="tasksList" class="list-unstyled mb-0"></ul>
  </div>
</div>


      <!-- Notes -->
      <div class="card flex-fill">
        <div class="card-header d-flex justify-content-between align-items-center">
          <strong>Notes</strong>
          <small id="notesDateLabel" class="text-muted"></small>
        </div>
        <div class="card-body p-2 day-sidebar-scroll">
          <textarea id="notesTextarea" class="form-control" rows="6" placeholder="Type notes for this day…"></textarea>
        </div>
      </div>
    </aside>
  </div>
</div>


      <div class="modal-footer">
        <button class="btn btn-primary" id="dayModalNewEvent">
          <i class="fas fa-plus me-1"></i> New Event
        </button>
        <button class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>

    <!-- Move Confirmation Modal -->
    <div class="modal fade" id="moveConfirmModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Confirm Move</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <p id="moveConfirmText">Move event?</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-outline-primary" id="copyEvent">
                        <i class="fas fa-copy me-1"></i>Copy Instead
                    </button>
                    <button type="button" class="btn btn-primary" id="confirmMove">
                        <i class="fas fa-arrows-alt me-1"></i>Move Event
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Layer Management Modal -->
    <div class="modal fade" id="layerModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="layerModalTitle">New Layer</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="layerForm">
                        <input type="hidden" id="layerId">
                        
                        <div class="mb-3">
                            <label for="layerName" class="form-label">Layer Name *</label>
                            <input type="text" class="form-control" id="layerName" required placeholder="e.g. Swimming Lessons">
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label">Color *</label>
                            <div class="color-picker-grid" id="colorPicker">
                                <div class="color-option" data-color="#28a745" style="background-color: #28a745;"></div>
                                <div class="color-option" data-color="#007bff" style="background-color: #007bff;"></div>
                                <div class="color-option" data-color="#fd7e14" style="background-color: #fd7e14;"></div>
                                <div class="color-option" data-color="#e83e8c" style="background-color: #e83e8c;"></div>
                                <div class="color-option" data-color="#6f42c1" style="background-color: #6f42c1;"></div>
                                <div class="color-option" data-color="#20c997" style="background-color: #20c997;"></div>
                                <div class="color-option" data-color="#dc3545" style="background-color: #dc3545;"></div>
                                <div class="color-option" data-color="#ffc107" style="background-color: #ffc107;"></div>
                                <div class="color-option" data-color="#6c757d" style="background-color: #6c757d;"></div>
                                <div class="color-option" data-color="#17a2b8" style="background-color: #17a2b8;"></div>
                                <div class="color-option" data-color="#343a40" style="background-color: #343a40;"></div>
                                <div class="color-option" data-color="#f8f9fa" style="background-color: #f8f9fa;"></div>
                            </div>
                            <input type="hidden" id="layerColor" required>
                        </div>
                        
                        <div class="mb-3">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="layerVisible" checked>
                                <label class="form-check-label" for="layerVisible">
                                    Show this layer by default
                                </label>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="saveLayer">
                        <i class="fas fa-save me-1"></i>Save Layer
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Delete Layer Confirmation Modal -->
    <div class="modal fade" id="deleteLayerModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Delete Layer</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="alert alert-warning">
                        <i class="fas fa-exclamation-triangle me-2"></i>
                        <strong>Warning!</strong> This action cannot be undone.
                    </div>
                    <p id="deleteLayerText">Are you sure you want to delete this layer?</p>
                    <div id="layerEventsMigration" style="display: none;">
                        <hr>
                        <p><strong>This layer contains events.</strong> What should happen to them?</p>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="migrationOption" id="moveEvents" value="move" checked>
                            <label class="form-check-label" for="moveEvents">
                                Move events to another layer:
                            </label>
                        </div>
                        <select class="form-control mt-2 ms-4" id="migrationLayer">
                            <!-- Options populated dynamically -->
                        </select>
                        <div class="form-check mt-2">
                            <input class="form-check-input" type="radio" name="migrationOption" id="deleteEvents" value="delete">
                            <label class="form-check-label" for="deleteEvents">
                                Delete all events in this layer
                            </label>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-danger" id="confirmDeleteLayer">
                        <i class="fas fa-trash me-1"></i>Delete Layer
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="{{ url_for('static', filename='js/full.js') }}"></script>
    
    <!-- Base modules (no dependencies) -->
    <!-- <script src="{{ url_for('static', filename='js/drag-drop-handler.js') }}"></script>
    <script src="{{ url_for('static', filename='js/layer-manager.js') }}"></script>
    <script src="{{ url_for('static', filename='js/task-manager.js') }}"></script>
    <script src="{{ url_for('static', filename='js/day-modal-manager.js') }}"></script>
    <script src="{{ url_for('static', filename='js/event-manager.js') }}"></script>
    <script src="{{ url_for('static', filename='js/calendar-renderer.js') }}"></script>
    <script src="{{ url_for('static', filename='js/calendar.js') }}"></script>
    <script src="{{ url_for('static', filename='js/calendar-init.js') }}"></script> -->
</body>
<script>
/* --- Bootstrap multi-modal stacking --- */
document.addEventListener('show.bs.modal', function (e) {
  const open = document.querySelectorAll('.modal.show').length;
  const z = 1050 + open * 20;              // step each modal by 20
  e.target.style.zIndex = z;

  // bump the *latest* backdrop under this modal
  setTimeout(() => {
    const backs = document.querySelectorAll('.modal-backdrop:not(.modal-stack)');
    const backdrop = backs[backs.length - 1];
    if (backdrop) {
      backdrop.style.zIndex = z - 10;
      backdrop.classList.add('modal-stack');
    }
  }, 0);
});

// keep body scroll locked when closing one of many modals
document.addEventListener('hidden.bs.modal', function () {
  if (document.querySelectorAll('.modal.show').length > 0) {
    document.body.classList.add('modal-open');
  }
});
</script>

</html>

